// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

// ------------------------
//   ENUMS
// ------------------------

enum Role {
  ADMIN
  OWNER
  GUEST
}

enum RoomStatus {
  AVAILABLE
  UNAVAILABLE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  REJECTED
  CANCELLED
}

enum IdempotencyStatus {
  IN_PROGRESS
  COMPLETED
  FAILED
}

// ------------------------
//   MODELS (TABLES)
// ------------------------

// Users table
model User {
  id        Int      @id @default(autoincrement())
  firstName String   @map("first_name")
  lastName  String   @map("last_name")
  role      Role
  password  String
  email     String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  reservations Reservation[]
  properties   Property[]

  @@map("users")
}

// Property table (Room)
model Property {
  id          Int           @id @default(autoincrement())
  name        String
  description String?
  ownerId     Int           @map("owner_id")
  pricePerDay Decimal       @map("price_per_day")
  capacity    Int
  status      RoomStatus
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  owner       User          @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  bookings    Reservation[]

  @@map("properties")
}

// Reservation table
model Reservation {
  id         Int           @id @default(autoincrement())
  roomId     Int           @map("room_id")
  reserverId Int           @map("reserver_id")
  checkIn    DateTime      @map("check_in")
  checkOut   DateTime      @map("check_out")
  status     BookingStatus
  createdAt  DateTime      @default(now()) @map("created_at")
  updatedAt  DateTime      @updatedAt @map("updated_at")

  // Relations
  room  Property @relation(fields: [roomId], references: [id], onDelete: Cascade)
  guest User     @relation(fields: [reserverId], references: [id], onDelete: Cascade)

  @@map("reservations")
}

model Idempotency {
  idempotencyKey    String            @id @map("idempotency_key") @db.VarChar(255)
  response          Json?
  createdAt         DateTime          @default(now()) @map("created_at")
  expiresAt         DateTime          @map("expires_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  idempotencyStatus IdempotencyStatus @map("idempotency_status")

  @@map("idempotencies")
}
